<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Tutor Virtual</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
        #respuesta { 
            background-color: #f4f4f4; 
            border-radius: 8px; 
            padding: 16px; 
            min-height: 100px; 
            white-space: pre-wrap; /* Mantiene los saltos de línea */
        }
        #respuesta.error { /* Estilo para cuando hay un error */
            background-color: #fff0f0;
            color: #d00;
        }
    </style>
</head>
<body>

    <h1>Mi Tutor Virtual</h1>
    <p>Haz clic en el botón para pedirle un cuento al robot.</p>

    <button id="miBoton">Preguntar a la IA</button>

    <h2>Respuesta de la IA:</h2>
    <div id="respuesta">...esperando...</div>

    <script>
        // ¡ESPERA A QUE LA PÁGINA ESTÉ LISTA!
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. Ahora sí, encontramos los botones
            const miBoton = document.getElementById('miBoton');
            const panelRespuesta = document.getElementById('respuesta');

            // 2. Escuchamos cuando alguien hace clic
            miBoton.onclick = async function() {
                
                // 3. Limpiamos errores y mostramos "Pensando..."
                panelRespuesta.classList.remove('error');
                panelRespuesta.innerText = "Pensando...";
                miBoton.disabled = true;

                // 4. ¡INTENTAMOS llamar a la cocina!
                try {
                    const response = await fetch('/api/chat');

                    // Si la cocina devuelve un error (ej: 500)
                    if (!response.ok) {
                        // Lanza un error para que lo atrape el 'catch'
                        throw new Error(`Error del servidor: ${response.status}`);
                    }

                    const data = await response.json();

                    // Si la cocina SÍ mandó un JSON pero con un error dentro
                    if (data.error) {
                         throw new Error(`Error de la API: ${data.error}`);
                    }

                    // 5. ¡ÉXITO! Mostramos la respuesta
                    panelRespuesta.innerText = data.respuesta;

                } catch (error) {
                    // 6. ¡FALLÓ! Mostramos el error en la caja
                    console.error("Error al llamar al API:", error);
                    panelRespuesta.innerText = `¡Oh no! Algo salió mal.\n\nDetalle: ${error.message}`;
                    panelRespuesta.classList.add('error');
                }

                // 7. Pase lo que pase, volvemos a activar el botón
                miBoton.disabled = false;
            };
        });
    </script>

</body>
</html>
